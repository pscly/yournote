## [2026-01-25 11:21] - 任务：补齐 Docker 部署（前端+后端）
- 原始需求：为项目补齐 Dockerfile + docker-compose；不要引入 PostgreSQL 镜像；让服务器在远端可直接 `docker compose` 部署与更新。
- 实现目标/逻辑：
  - 后端：基于 Python 3.13 + `uv.lock` 构建镜像，使用 `uv sync` 安装依赖；运行 `python backend/run.py`（生产默认关闭 reload）。
  - 前端：Vite 构建产物用 Nginx 提供静态服务，并在 Nginx 侧把 `/api`、`/docs` 等转发到后端容器，保证浏览器同源访问（前端默认 `API_BASE_URL=/api`）。
  - 数据持久化：SQLite DB 与访问日志目录通过 volume 绑定到宿主机（`./data`、`./logs`），更新镜像不丢数据。
- 核心变更：新增 `docker-compose.yml`、`backend/Dockerfile`、`frontend/Dockerfile`、`frontend/nginx.conf`、`.dockerignore` 等部署相关文件。
- 遗留/约束：
  - 不包含 PostgreSQL 镜像；如需切换到远程 PG，仅通过 `.env`/环境变量配置 `DATABASE_URL`。
  - 服务器更新流程：`git pull` 后执行 `docker compose up -d --build`（或 `docker-compose up -d --build`）。

## [2026-01-26 09:45] - 任务：新增部署与CI技能（docker-compose + GitLab CI/CD）
- 原始需求：你现在开发个 skill ，关于 docker-compose 部署相关，和gitlab cicd 相关(基于这个项目的架构，你开发一下呢)
- 实现目标/逻辑：
  - 基于当前仓库既有部署文件（`docker-compose.yml`、`backend/Dockerfile`、`frontend/Dockerfile`、`frontend/nginx.conf`、`.gitlab-ci.yml`）提炼可复用流程与检查清单。
  - Skill 面向 Codex：在用户提出“容器化部署 / docker compose / 自动发布 / GitLab Runner”等需求时，指导按最小改动落地，并保持数据持久化与 `.env` 不被流水线覆盖。
- 核心变更：新增 `.codex/skills/yournote-docker-gitlab/SKILL.md`、`.codex/skills/yournote-docker-gitlab/references/compose.md`、`.codex/skills/yournote-docker-gitlab/references/gitlab-ci.md`。
- 遗留/约束：
  - 不自动执行 `git commit`（除非用户明确要求）。
  - 延续约束：不引入 PostgreSQL 容器；默认 SQLite + volume 持久化，切换 PG 仅通过 `DATABASE_URL` 外部接入。

## [2026-01-26 09:58] - 任务：将部署与CI Skill 全局化并完善
- 原始需求：你现在把这个skill 开发成全局的，记得修改的非常完善和非常完美，
- 实现目标/逻辑：
  - 完善 `yournote-docker-gitlab` 的触发描述、工作流、排障与运维安全清单，使其不仅适配本仓库，也能作为类似架构项目的通用范式。
  - 将 Skill 安装到全局目录 `C:/Users/pscly/.codex/skills/`，使其在任意项目中可用（仓库内版本作为“源代码/开发版本”保留）。
- 核心变更：
  - 完善 Skill：更新 `.codex/skills/yournote-docker-gitlab/SKILL.md`、补充与增强 `references/*`（新增 `ops-security.md`、`troubleshooting.md`、`templates.md`）。
  - 全局安装：已同步复制到 `C:/Users/pscly/.codex/skills/yournote-docker-gitlab/`。
- 遗留/约束：
  - 全局安装需要写入用户目录（可能触发权限确认）。
  - 仍保持 CI 不覆盖服务器 `.env`、compose 持久化 `./data` 与 `./logs` 的原则。

## [2026-01-26 14:31] - 任务：倾向采用 SSH 远端部署方案（GitLab CI）
- 原始需求：那我感觉 SSH 方案会更好一些的感觉
- 实现目标/逻辑：
  - 采用“Runner 不在目标服务器”的发布模型：CI 通过 `rsync` 同步代码到服务器 `DEPLOY_DIR`，再通过 `ssh` 在服务器上执行 `docker compose up -d --build --remove-orphans`。
  - 继续遵循：CI 不覆盖服务器 `.env`；同步时排除 `data/`、`logs/` 保留持久化数据。
- 核心变更：待办把 `.gitlab-ci.yml` 调整为 SSH 部署 Job，并要求在 GitLab CI Variables 配置 `DEPLOY_HOST/DEPLOY_USER/DEPLOY_DIR/DEPLOY_PORT/DEPLOY_SSH_PRIVATE_KEY` 等。
- 遗留/约束：需确认目标服务器已安装 Docker + Compose v2、以及 deploy 用户执行 docker 的权限策略（docker group 或受限 sudo）。

## [2026-01-26 15:23] - 任务：主页账号列表默认收起
- 原始需求：把主页的「账号列表」改成默认就是收起的，然后自动提交并推送到 Git（GitHub+GitLab）。
- 实现目标/逻辑：
  - 将账号列表的默认折叠状态改为“默认收起”，且保留用户手动展开/收起并记忆的能力。
  - 为避免旧版本本地存储的历史偏好影响新默认值，对 localStorage key 进行 v2 版本化。
- 核心变更：更新 rontend/src/pages/Dashboard.jsx（默认折叠逻辑与存储 key）。
- 遗留/约束：无。
