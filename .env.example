# 说明：
# - 本项目会优先读取仓库根目录的 `.env`（即使你是在 backend/ 或 frontend/ 目录启动）。
# - `.env` 的优先级最高：会覆盖同名的系统环境变量。

# =========================
# 端口 / 启动配置
# =========================

# 后端监听地址与端口（backend/run.py 使用）
BACKEND_HOST=0.0.0.0
BACKEND_PORT=31012
BACKEND_RELOAD=true

# 前端开发服务端口（frontend/vite.config.js、frontend/playwright.config.js 使用）
FRONTEND_PORT=31011

# =========================
# 数据库配置
# =========================

# 推荐：只配置 SQLITE_DB_PATH（后端会自动生成 DATABASE_URL）
# - 相对路径会以仓库根目录为基准
SQLITE_DB_PATH=./yournote.db

# 高级：直接指定完整连接串（会覆盖 SQLITE_DB_PATH）
# DATABASE_URL=sqlite+aiosqlite:///./yournote.db
# DATABASE_URL=postgresql+asyncpg://username:password@localhost:5432/yournote

# =========================
# API 配置
# =========================
API_PREFIX=/api
DEBUG=true
# 是否输出 SQLAlchemy 的 SQL 语句日志（`INFO sqlalchemy.engine.Engine ...`）
# - 频繁轮询接口时会刷屏并拖慢后端
# - 需要排查 SQL/事务时再临时打开
SQL_ECHO=false

# =========================
# 访问密码相关（站点级门禁）
# =========================
# 说明：
# - 本项目支持一个“访问密码”门禁：未登录时所有 /api/** 均返回 401。
# - 登录成功后会写入 HttpOnly Cookie，默认 90 天有效。
# - 开关优先级：ACCESS_ENABLED（显式） > ISPWD（是否需要密码） > 自动判断（配置了密码即启用）
#
# 是否需要访问密码：
# - ISPWD=true：需要密码（启用门禁）
# - ISPWD=false：不需要密码也可以访问（关闭门禁）
ISPWD=true
#
# 最简单方式：配置明文密码（本地工具场景足够）
PWD=131
#
# 推荐方式：配置 PBKDF2 hash（避免把“可重放的 sha256 值/明文”直接写入 .env）    
# 生成命令（PowerShell 7，仓库根目录执行）：
#   cd backend
#   uv run python -c "from app.utils.access_password import generate_access_password_hash; print(generate_access_password_hash('131'))"
# ACCESS_PASSWORD_HASH=pbkdf2_sha256$210000$<salt_b64>$<hash_b64>
#
# 可选：显式开关（不配则自动判断）
# ACCESS_ENABLED=true
#
# 可选：会话签名 secret（不配则在存在 PWD 时自动派生；部署到公网建议显式配置随机值）
# 生成命令（PowerShell 7）：
#   ([Convert]::ToBase64String([System.Security.Cryptography.RandomNumberGenerator]::GetBytes(32)))
# ACCESS_SESSION_SECRET=<随机长字符串>
#
# 可选：改密码后递增，用于让旧 Cookie 失效
# ACCESS_PASSWORD_VERSION=1
#
# 可选：会话天数
# ACCESS_SESSION_DAYS=90
#
# Cookie 配置
# ACCESS_COOKIE_NAME=yournote_access
# ACCESS_COOKIE_SAMESITE=Lax
# ACCESS_COOKIE_SECURE=auto
#
# 登录防爆破
# ACCESS_RATE_LIMIT_WINDOW_SECONDS=300
# ACCESS_RATE_LIMIT_MAX_ATTEMPTS=20

# =========================
# CORS（跨域）
# =========================
# 逗号分隔；默认 "*" 表示允许所有来源（此时后端会强制关闭 allow_credentials）
# 示例：CORS_ALLOW_ORIGINS=http://localhost:31011,http://127.0.0.1:31011
CORS_ALLOW_ORIGINS=*
# 是否允许携带凭证（Cookie 等）。当 CORS_ALLOW_ORIGINS="*" 时无效（会被强制关闭）
CORS_ALLOW_CREDENTIALS=false
# CORS_ALLOW_METHODS=*
# CORS_ALLOW_HEADERS=*

# =========================
# 同步配置
# =========================
# 启动时是否触发一次“全账号同步”（后台执行，不阻塞启动）
SYNC_ON_STARTUP=true
SYNC_INTERVAL_MINUTES=20
# 兼容旧配置（小时）：
# SYNC_INTERVAL_HOURS=6

# =========================
# 访问日志（按天写入本地 logs/）
# =========================
# 是否启用访问日志
ACCESS_LOG_ENABLED=true
# 日志目录（相对路径以仓库根目录为基准）
ACCESS_LOG_DIR=logs
# 逗号分隔：完全匹配 path（不含 query）时跳过记录
ACCESS_LOG_IGNORE_PATHS=/health,/api/access-logs/pageview,/api/access-logs/file
# 是否记录 querystring（建议默认 false，避免无意间写入敏感参数）
ACCESS_LOG_INCLUDE_QUERY=false
