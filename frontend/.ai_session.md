## [2026-01-22 00:00] - 任务：阅读页列表自动定位 + 访问慢/超时排查
- 原始需求：看日记详情时，左侧/抽屉里的日记列表能自动定位到当前日记位置；并修复访问慢、偶发超时导致前端拿不到数据的问题。
- 实现目标/逻辑：
  - 在 `DiaryDetail` 的列表渲染后，找到“当前日记”条目并触发滚动定位（优先滚到居中），避免每次从顶部开始找。
  - 排查前端“超时”来源（通常是 HTTP 客户端超时或并发请求过多导致后端阻塞），在不改变业务口径的前提下提升稳定性（延长超时、必要的重试/降载）。
- 核心变更：待实现（预计涉及 `frontend/src/pages/DiaryDetail.jsx`、`frontend/src/services/api.js`、必要时 `frontend/src/pages/DiaryList.jsx`）。
- 遗留/约束：
  - Windows + pwsh7 环境；所有新增/修改文件需 UTF-8（无 BOM）。
  - 本仓库存在 `backend/` 与 `frontend/`，按“多子项目隔离”规则，本会话记录放在 `frontend/.ai_session.md`。

## [2026-01-22 00:00] - 进展：已完成滚动定位与超时优化
- 原始需求：同上。
- 实现目标/逻辑：
  - 阅读页：通过 `ref + scrollIntoView` 在列表容器内滚到当前日记，并在已可见时不重复滚动。
  - 访问慢/超时：将 axios 默认超时从 10s 放宽到 30s，并对幂等 GET 做有限次重试（指数退避），降低偶发网络抖动/后端瞬时压力导致的“前端直接超时”。
  - 列表页降载：多账号聚合加载改为“分批并发”（每批 3 个账号）并缓存 `paired` 结果，减少请求洪峰与重复请求；引入请求序号避免并发返回覆盖最新 UI。
- 核心变更：
  - `frontend/src/pages/DiaryDetail.jsx`：新增 `currentDiaryId`、列表容器/当前条目 refs、自动滚动定位逻辑。
  - `frontend/src/services/api.js`：默认超时 30s + GET 自动重试（最多 2 次）。
  - `frontend/src/pages/DiaryList.jsx`：分批加载 + paired 缓存 + loadSeq 防止竞态覆盖。
  - `frontend/eslint.config.js`：补充 Playwright 配置/测试的 Node 全局变量（使 lint 可用）。
- 遗留/约束：
  - `npm -C frontend run lint` 仍有 1 条既有 warning（`SyncMonitor.jsx` 的 hooks 依赖），不影响本次功能与构建。

## [2026-01-23 21:11] - 任务：发布日记改为后台执行（非阻塞）
- 原始需求：前端点击“发布日记/发布到所选账号”后应后台发布，不要弹出阻塞弹窗导致只能取消。
- 实现目标/逻辑：
  - 点击发布后直接开始创建 run 并逐账号发布；不再自动弹出 `Modal.confirm`/结果弹窗来阻塞页面。
  - 用非阻塞的 `message` 提示发布开始/结束，并引导用户在“发布历史”里查看明细（需要时再手动打开“发布结果”）。
  - 保留 run 记录与逐账号状态更新逻辑，确保发布过程可追踪。
- 核心变更：预计涉及 `frontend/src/pages/PublishDiary.jsx`（发布按钮逻辑、提示与结果弹窗触发方式）。
- 遗留/约束：Windows + pwsh7；所有新增/修改文件需 UTF-8（无 BOM）；避免重复触发发布。

## [2026-01-23 21:14] - 进展：已改为后台发布不阻塞
- 原始需求：同上。
- 实现目标/逻辑：
  - 发布按钮点击后直接开始发布流程（创建 run + 逐账号发布），不再弹出阻塞式确认弹窗，也不再自动打开“发布结果”弹窗。
  - 用 `message.open({ key })` 显示“发布中/发布完成/发布失败”状态提示，用户可继续操作；需要看明细时在“发布历史”点“查看”。
  - 保留 runDetail 的逐账号状态更新与最终拉取合并逻辑，确保结果与后端落库一致。
- 核心变更：
  - `frontend/src/pages/PublishDiary.jsx`：移除 `Modal.confirm` 与 `setRunModalOpen(true)`，发布改为后台执行并用 message 反馈；发布按钮 `disabled` 增加 `publishing` 防止重复触发。
- 遗留/约束：`npm -C frontend run lint` 仍有 1 条既有 warning（`SyncMonitor.jsx` 的 hooks 依赖），不影响本次功能与构建。
